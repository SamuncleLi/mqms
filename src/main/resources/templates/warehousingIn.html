<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/themes/icon.css">
    <script type="text/javascript" src="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/jquery.min.js"></script>
    <script type="text/javascript" src="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/locale/easyui-lang-zh_CN.js"></script>
    <style type="text/css">
        html { overflow-y:hidden; }
        td{
            padding: 5px;
        }
        .easyui-textbox{
            width: 135px;
        }
        .easyui-combobox{
            width: 135px;
        }
    </style>
    <script type="text/javascript">
        $(function () {
            $("#dg").datagrid({
                url:"/wms/warehousing/in/list",
                method:"GET",
            })
            $('.goods-tr').hide();
            $('.spare-parts-tr').hide();
            $("#managementType").combobox({
                onSelect:function (record) {
                    console.log(record)
                    if(record.text=='备件'){
                        $('.spare-parts-tr').show();
                        $('.goods-tr').hide();
                    }
                    else if (record.text=='资材'){
                        $('.spare-parts-tr').hide();
                        $('.goods-tr').show();
                    }
                }
            })
            $('#materialCode').combobox('textbox').keyup(function (e) {
                //显示下拉面板，下拉面板是模糊搜索结果
                if (e.keyCode != 13 && input.combobox('getText').length>4) {
                    //获取当前操作的行，并给对应行赋值
                    input.combobox('reload','/wms/material/list/fuzzySearch?materialCode=' + input.combobox('getText'));
                    input.combobox('showPanel');
                }
            })
            $('#materialCode').combobox({
                onSelect:function (record) {
                    $('#materialName').textbox('setValue',result.materialName);
                    $('#materialSpecs').textbox('setValue',result.materialSpecs);
                    $('#supplierCode').textbox('setValue',result.supplierCode);
                    $('#warehouseCode').textbox('setValue',result.warehouseCode);
                }
            })
        })
        function add() {
            $('#dlg').dialog("open", "新增入库申请")
        }
        function saveDlg() {
            var url= "/wms/order/build";
            $("#fm").form("submit", {
                url: url,
                dataType: "json",
                onSubmit: function () {
                    return true
                },
                success: function (result) {
                    console.log(result);
                    var result = JSON.parse(result);
                    if (result.success != "true") {
                        $.messager.alert('系统提示', "<font color=red>" + result.errorMsg + "</font>");
                        return;
                    } else {
                        $.messager.alert('系统提示', '保存成功');
                        $("#dg").datagrid("reload");
                        $("#dlg").dialog("close");
                        $("#fm").form("clear");
                    }
                }
            })
        }
        function closeDlg() {
            $('#dlg').dialog('close');
        }
        function excelFileUpload() {
            //首先验证文件格式
            var fileName = $('#excelFile').val();
            if (fileName === '') {
                alert('请选择文件');
                return false;
            }
            var fileType = (fileName.substring(fileName
                            .lastIndexOf(".") + 1, fileName.length))
                    .toLowerCase();
            if (fileType !== 'xls' && fileType !== 'xlxs') {
                alert('文件格式不正确，请上传bpmn文件！');
                return false;
            }
            alert('系统提示',"正在上传，上传完成后会有提示，请耐心等候");
            $("#excelForm").ajaxSubmit({
                url:"/",
                dataType:"json",
                success:function(data) {
                    if (data.success == 'true') {
                        $.messager.alert("系统提示",'上传文件成功');
                    } else {
                        $.messager.alert("系统提示",'上传文件失败');
                    }
                    return false;
                }
            });
            return false;
        }
        function closeExcelDlg() {
            $('#excelDlg').dialog('close');
        }
        function openUploadDlg(){
            $('#excelDlg').dialog('open','上传excel');
        }
//        function searchMaterial(){
//            $.getJSON("/wms/material/listLimit1",{materialCode:$('#materialCode').textbox('getText')},function (result) {
//                console.log(result);
//                $('#materialName').textbox('setValue',result.materialName);
//                $('#materialSpecs').textbox('setValue',result.materialSpecs);
//                $('#supplierCode').textbox('setValue',result.supplierCode);
//                $('#warehouseCode').textbox('setValue',result.warehouseCode);
//
//                if(result.materialName == undefined){
//                    $.messager.confirm({
//                        title:"系统提示",
//                        msg:"物料不存在，是否是新增物料",
//                        ok:"是",
//                        cancel:"否",
//                        fn:function (r) {
//                            if (r){
//                                //如果是新物料，则勾选新物料选项
//                            }
//                            else{
//                                //如果用户确认不是新物料，则清空
//                            }
//                        }
//                    });
//                }
//            })
//        }
    </script>
<body style="overflow-y: hidden">
<div id="tb">
    <div>
        <a href="javascript:add()" class="easyui-linkbutton" iconCls="icon-add" >新增</a>
        <a href="javascript:saveProcessChecker()" class="easyui-linkbutton" iconCls="icon-edit" >修改</a>
        <a href="javascript:saveProcessChecker()" class="easyui-linkbutton" iconCls="icon-remove" >删除</a>
        <a href="javascript:openUploadDlg()" class="easyui-linkbutton">导入excel</a>
        <a href="javascript:saveProcessChecker()" class="easyui-linkbutton">导出excel</a>
    </div>
    <div>
        <table>
            <tr>
                <td>物料号:</td><td><input id="materialCode" name="materialCode" class="easyui-combobox"></td>
                <td>物料名称:</td><td><input id="materialName" name="materialName" class="easyui-textbox"></td>
                <td>规格:</td><td><input id="materialCode" name="materialCode" class="easyui-textbox"></td>
            </tr>
            <tr>
                <td>订单号:</td><td><input id="orderCode" name="orderCode" class="easyui-textbox"></td>
                <td>事务处理时间:</td><td><input id="warehousingAffairDate" name="warehousingAffairDate" class="easyui-textbox"></td>
                <td>原因代码:</td><td><input id="warehousingAffairCode" name="warehousingAffairCode" class="easyui-textbox"></td>
                <td><a href="javascript:searchProcessChecker()" class="easyui-linkbutton" iconCls="icon-search" >搜索</a></td>
            </tr>
            <tr>

            </tr>
        </table>
    </div>
</div>

<table id="dg" title="入库信息" class="easyui-datagrid" fitColumns="false"
       pagination="true" rownumbers="true" fit="true" toolbar="#tb" method="GET">
    <thead frozen="true">
    <tr>
        <th field="cb" checkbox="true" align="center"></th>
        <th field="orderCode" align="center">订单编号</th>
    </tr>
    </thead>
    <thead>
    <tr>
        <th field="warehousingCode" align="center">调整订单号</th>
        <th field="warehousingLineCode" align="center">调整订单号行号</th>
        <th field="warehousingReasonCode" align="center">调整原因</th>
        <th field="warehousingReasonDescription" align="center">调整原因描述</th>
        <th field="warehousingAffairsDate" align="center">事务处理日期</th>
        <th field="materialCode" align="center">物料编号</th>
        <th field="materialName" align="center">物料名称</th>
        <th field="materialUnit" align="center">单位</th>
        <th field="warehousingBatch" align="center">批次</th>
        <th field="warehousingSerie" align="center">序列号</th>
        <th field="warehouseCode" align="center">仓库代码</th>
        <th field="warehousingAffairsSymbol" align="center">事务处理标识</th>
        <th field="warehousingNum" align="center">数量</th>
        <th field="warehousingHeadText" align="center">头文本</th>
        <th field="warehousingLineText" align="center">行文本</th>
        <th field="warehousingInitialUserId" align="center">申请人</th>
        <th field="warehousingInitialTime" align="center">申请时间</th>
        <th field="warehousingInitialState" align="center">申请状态</th>
        <th field="warehousingId" align="center" hidden="hidden"></th>
    </tr>
    </thead>
</table>

<div id="dlg" name="dlg" class="easyui-dialog" title="新增入库" style="width: 800px;height: 600px" closed="true" buttons="#dlgbutton">
    <form id="fm" method="post">
        <table id="erp_template">
            <tr>
                <td>物料编号</td><td><input class="easyui-textbox" id="orderMaterialName" name="orderMaterialName"></td>
                <td>物料名称</td><td><input class="easyui-textbox" id="" name=""></td>
                <td>规格</td><td><input class="easyui-textbox" id="" name=""></td>
            </tr>
            <tr>
                <td>供应商编号</td><td><input class="easyui-textbox" id="" name=""></td>
                <td>订购数</td><td><input class="easyui-textbox" id="" name=""></td>
                <td>仓库编码</td><td><input class="easyui-textbox" id="" name=""></td>
            </tr>
            <tr>
                <td>库位</td><td><input class="easyui-textbox" id="" name=""></td>
                <td>数量</td><td><input class="easyui-textbox" id="" name=""></td>
            </tr>
        </table>

    </form>
</div>
<div id="dlgbutton">
    <a href="javascript:saveDlg()" class="easyui-linkbutton">保存</a>
    <a href="javascript:closeDlg()" class="easyui-linkbutton">关闭</a>
</div>

<div id="excelDlg" name="dlg" class="easyui-dialog" title="上传订单" style="width: 800px;height: 600px" closed="true" buttons="#excelDlgbutton">
    <form  method="post" enctype="multipart/form-data" id="excelForm" action="/wms/warehousing/upload">
        <input type="file" name="file" id="file"/>
        <input type="submit" value="上传文件"/>
    </form>
</div>
<div id="excelDlgbutton">
    <a href="javascript:closeExcelDlg()" class="easyui-linkbutton">关闭</a>
</div>
</body>
</html>