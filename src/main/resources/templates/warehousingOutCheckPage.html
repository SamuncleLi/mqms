<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>FTL模板</title>
    <link rel="stylesheet" type="text/css" href="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/themes/icon.css">
    <script type="text/javascript" src="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/jquery.min.js"></script>
    <script type="text/javascript" src="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="${req.contextPath}/static/plugin/jquery-easyui-1.5.5.4/locale/easyui-lang-zh_CN.js"></script>
    <style type="text/css">
        html { overflow-y:hidden; }
        td{
            padding: 5px;
        }
        .easyui-textbox{
            width: 135px;
        }
        .easyui-combobox{
            width: 135px;
        }
    </style>
    <script type="text/javascript">
        var details;
        window.addEventListener('message',function(event){
            var obj = event.data;
            console.log(event);
            console.log(obj);
            var type = obj.type;
            if (type=="details"){
                details=obj.details;
                console.log(details);
                //表单读取数据
                $('#dg').datagrid({
                    url:'/wms/warehousing/out/list?simpleApplicationObjectId='+details.simpleApplicationObjectId
                })
            }
        }, false);

        //向流程系统发送同意
        function agree() {
            $.messager.confirm("系统提示","您确认要提交结果么？一旦提交将无法撤回！",function(r) {
                if (r) {
                    //发送请求
                    $.post("/wms/warehousing/audit",
                            {simpleApplicationObjectId:details.simpleApplicationObjectId,
                        processInstId:details.processInstId,
                        taskId:details.taskId,
                        auditorInfo:"agree",
                        auditorComment:"",
                        assigneeId:details.assigneeId,
                        variables:"",
                        arrayVariables:""}, function (result) {
                                //显示返回信息并将信息返回给主页面
//                        $("#dlg4").dialog("close");
                                var result = eval('(' + result + ')');
                                if (result.success = "true") {
                                    $.messager.alert("系统提示", "提交成功");
                                }
                                else {
                                    $.messager.alert("系统提示", result.errorMsg);
                                }
                                console.log(result);
                                window.parent.postMessage(result, '*');
                            }
                    );
                }
            });

        }

        //向流程系统发送不同意
        function disagree(){

        }

        function webview(obj){
            $.messager.alert("系统提示", "ok");
           /* var obj=eval('('+obj+')');
            $('#tb').hide();
            $.messager.alert("系统提示", "ok");
            details=obj;
            console.log(details);
            //表单读取数据
            $('#dg').datagrid({
                url:'/wms/order/list?simpleApplicationObjectId='+details.simpleApplicationObjectId
            })*/
        }
    </script>
</head>
<body style="overflow-y: hidden">
    <div id="div" style="width: 100%;height: 100%;border:1px solid #97CBFF" class="easyui-layout">
        <div  style="width: 100%;height: 30px;border-bottom:1px solid #97CBFF;background: #ECF5FF;color: #0E2D5F"><b>调整出库详情</b></div>
        <table id="dg" class="easyui-datagrid" fitColumns="true"
               pagination="true" rownumbers="true" fit="true" toolbar="#tb" method="GET"
               pageList="[ 10, 50, 100, 500, 2000]">
            <thead>
                <tr>
                    <th field="warehousingReasonCode" align="center">调整原因</th>
                    <th field="warehousingReasonDescription" align="center">调整原因描述</th>
                    <th field="warehousingAffairsDate" align="center">事务处理日期</th>
                    <th field="warehousingInitialUserId" align="center">申请人</th>
                    <th field="warehousingInitialTime" align="center">申请时间</th>
                    <th field="materialCode" align="center">物料编号</th>
                    <th field="materialName" align="center">物料名称</th>
                    <th field="materialUnit" align="center">单位</th>
                    <th field="warehousingBatch" align="center">批次</th>
                    <th field="warehousingSerie" align="center">序列号</th>
                    <th field="warehouseCode" align="center">仓库代码</th>
                    <th field="warehousingAffairsSymbol" align="center">事务处理标识</th>
                    <th field="warehousingNum" align="center">数量</th>
                    <th field="warehousingInitialState" align="center">申请状态</th>
                    <th field="warehousingId" align="center" hidden="hidden"></th>
                </tr>
            </thead>
        </table>
        <div id="tb">
            <a href="javascript:agree()" class="easyui-linkbutton" iconCls="icon-ok" plain="true" id="agree" >同意</a>
            <a href="javascript:disagree()" class="easyui-linkbutton" iconCls="icon-cancel" plain="true" id="disagree" >不同意</a>
        </div>
    </div>
</body>
</html>