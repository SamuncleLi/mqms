<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gamc.efactory.dao.MqmsVoucherMapper">
    <select id="selectClaimCount"  resultType="java.lang.Integer" >
    SELECT COUNT(*) FROM `mqms_voucher`
    WHERE  `eng_type` = #{engType}
    AND  `confirm_date` &gt;= #{beginDate}
    AND  `confirm_date` &lt;= #{endDate}
    AND  `sales_date` &gt;= #{beginDate}
    AND  `sales_date` &lt;= #{endDate}
</select>
    <select id="selectTransClaimCount"  resultType="java.lang.Integer" >
        SELECT COUNT(*) FROM `mqms_voucher`
        WHERE  `tran_type_detail` = #{tranTypeDetail}
        AND  `confirm_date` &gt;= #{beginDate}
        AND  `confirm_date` &lt;= #{endDate}
        AND  `sales_date` &gt;= #{beginDate}
        AND  `sales_date` &lt;= #{endDate}
    </select>
    <select id="selectCarMutilMount"  resultType="java.lang.Integer" >
        SELECT COUNT(*) FROM `mqms_voucher`
        WHERE  `car_model` = #{carModel}
        AND  `confirm_date` &gt;= #{beginDate}
        AND  `confirm_date` &lt;= #{endDate}
    </select>

    <select id="selectTotalCost"  resultType="java.math.BigDecimal" >
        SELECT SUM(`total_cost`) FROM `mqms_voucher`
        WHERE  `eng_type` = #{eng_type} AND  `confirm_date` LIKE  concat(#{confirm_date},'%')
    </select>

    <select id="selectByVoucherCode"  resultType="java.lang.Integer" >
        SELECT COUNT(*) FROM `mqms_voucher`
        WHERE  `voucher_code` = #{voucher_code}
    </select>
    <resultMap id="TransmissionProportionMap" type="TransmissionProportion">
        <result property="transmissionCodeRe" column="transmission_code_re"/>
        <result property="number" column="number"/>
    </resultMap>
    <resultMap id="FailureTop10Map" type="FailureTop10">
        <result property="engArrange" column="eng_arrange"/>
        <result property="number" column="number"/>
    </resultMap>
    <select id="calTransmissionProportion" resultMap="TransmissionProportionMap" parameterType="MqmsVoucher">
        SELECT
            transmission_code_re,
            count(*) as number
        FROM
            `mqms_voucher`
        <trim prefix="where" suffixOverrides="and | or">
            <if test="engType != null">
            `eng_type` = #{engType} and
            </if>
        </trim>
        GROUP BY
            transmission_code_re;
    </select>

    <select id="failureTop10" resultMap="FailureTop10Map" parameterType="MqmsVoucher">
        SELECT
        eng_arrange,
        count(*) as number
        FROM
        `mqms_voucher`
        <trim prefix="where" suffixOverrides="and | or">
            <if test="engType != null">
                `eng_type` = #{engType} and
            </if>
        </trim>
        GROUP BY
        eng_arrange
        ORDER BY
        number desc
        LIMIT 0,10;
    </select>
    <select id="transFailureTop10" resultMap="FailureTop10Map" parameterType="MqmsVoucher">
        SELECT
        eng_arrange,
        count(*) as number
        FROM
        `mqms_voucher`
        <trim prefix="where" suffixOverrides="and | or">
            <if test="engType != null">
                `tran_type_detail` = #{tranTypeDetail} and
            </if>
        </trim>
        GROUP BY
        eng_arrange
        ORDER BY
        number desc
        LIMIT 0,10;
    </select>

    <select id="countBetweenYearAndMonth" resultType="java.lang.Integer">
        SELECT count(*) FROM `mqms_voucher`
        WHERE
        eng_type = #{eng_type} and `sales_date` &gt;= #{begin} and `sales_date` &lt; #{end}
    </select>
    <select id="salesFailureTimeBetween" resultType="java.lang.Integer">
        SELECT count(*) FROM `mqms_voucher`
        WHERE
        eng_type = #{eng_type} and `sales_date` &gt;= #{begin} and `sales_date` &lt;= #{end}
    </select>    <select id="salesTransFailureTimeBetween" resultType="java.lang.Integer">
    SELECT count(*) FROM `mqms_voucher`
    WHERE
    `tran_type_detail` = #{tranTypeDetail} and `sales_date` &gt;= #{begin} and `sales_date` &lt;= #{end}
</select>


</mapper>