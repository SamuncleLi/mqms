<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gamc.efactory.dao.MqmsVoucherMapper">
    <resultMap type="com.gamc.efactory.model.dataObject.MqmsVoucher" id="MqmsVoucherMap">
        <result property="voucherId" column="voucher_id"/>
        <result property="voucherCode" column="voucher_code"/>
        <result property="claimCode" column="claim_code"/>
        <result property="dealerCode" column="dealer_code"/>
        <result property="dealerName" column="dealer_name"/>
        <result property="dealerShortName" column="dealer_short_name"/>
        <result property="theme" column="theme"/>
        <result property="vinCode" column="vin_code"/>
        <result property="vehicleType" column="vehicle_type"/>
        <result property="productionCode" column="production_code"/>
        <result property="partsCode" column="parts_code"/>
        <result property="partsName" column="parts_name"/>
        <result property="divisionLevel1" column="division_level_1"/>
        <result property="divisionLevel2" column="division_level_2"/>
        <result property="divisionLevel3" column="division_level_3"/>
        <result property="partsAndSymptom" column="parts_and_symptom"/>
        <result property="offlineDate" column="offline_date"/>
        <result property="salesDate" column="sales_date"/>
        <result property="failureDate" column="failure_date"/>
        <result property="mileage" column="mileage"/>
        <result property="confirmDate" column="confirm_date"/>
        <result property="warehousingDate" column="warehousing_date"/>
        <result property="transportDate" column="transport_date"/>
        <result property="shopArrivalDate" column="shop_arrival_date"/>
        <result property="salesFailureTime" column="sales_failure_time"/>
        <result property="failureDesc" column="failure_desc"/>
        <result property="diagnosticResult" column="diagnostic_result"/>
        <result property="manCost" column="man_cost"/>
        <result property="materialCost" column="material_cost"/>
        <result property="materialManagementCost" column="material_management_cost"/>
        <result property="goOutCost" column="go_out_cost"/>
        <result property="maintainingCost" column="maintaining_cost"/>
        <result property="otherCost" column="other_cost"/>
        <result property="totalCost" column="total_cost"/>
        <result property="importantLevel" column="important_level"/>
        <result property="transmissionType" column="transmission_type"/>
        <result property="newPartsBond" column="new_parts_bond"/>
        <result property="submitDate" column="submit_date"/>
        <result property="egtypeCode" column="egtype_code"/>
        <result property="engProductionDate" column="eng_production_date"/>
        <result property="transmissionCode" column="transmission_code"/>
        <result property="transmissionProductionDate" column="transmission_production_date"/>
        <result property="engArrange" column="eng_arrange"/>
        <result property="carModel" column="car_model"/>
        <result property="engType" column="eng_type"/>
        <result property="receiveTime" column="receive_time"/>
        <result property="claimCompensation" column="claim_compensation"/>
        <result property="productionRawDescription" column="production_raw_description"/>
        <result property="PDI" column="PDI"/>
        <result property="offlineFailureTime" column="offline_failure_time"/>
        <result property="engOrTran" column="eng_or_tran"/>
        <result property="carSeriesCode" column="car_series_code"/>
        <result property="shortCode" column="short_code"/>
        <result property="faultCodeClassification" column="fault_code_classification"/>
        <result property="failureYear" column="failure_year"/>
        <result property="failureMonth" column="failure_month"/>
        <result property="transmissionShortCode" column="transmission_short_code"/>
        <result property="mileageDistribution" column="mileage_distribution"/>
        <result property="returnRequest" column="return_request"/>
        <result property="returnDate" column="return_date"/>
        <result property="arriveDate" column="arrive_date"/>
        <result property="loadingVerification" column="loading_verification"/>
        <result property="faultReconstructioner" column="fault_reconstructioner"/>
        <result property="loadingDate" column="loading_date"/>
        <result property="faultReconstruction" column="fault_reconstruction"/>
        <result property="faultReconstructionDate" column="fault_reconstruction_date"/>
        <result property="transferDate1" column="transfer_date1"/>
        <result property="responsible1" column="responsible1"/>
        <result property="transferDate2" column="transfer_date2"/>
        <result property="responsible2" column="responsible2"/>
        <result property="estimateMeetingDate" column="estimate_meeting_date"/>
        <result property="submitReport" column="submit_report"/>
        <result property="reason" column="reason"/>
        <result property="countermeasure" column="countermeasure"/>
        <result property="reportSubmit" column="report_submit"/>
        <result property="claimIndemnity" column="claim_indemnity"/>
        <result property="questionType" column="question_type"/>
        <result property="questionState" column="question_state"/>
        <result property="responsibleDepartment" column="responsible_department"/>
        <result property="applierId" column="applier_id"/>
        <result property="applierName" column="applier_name"/>
        <result property="applyTime" column="apply_time"/>
    </resultMap>

    <select id="selectEngTypeCount"  resultType="java.lang.Integer" >
        SELECT COUNT(*) FROM `mqms_voucher`
        WHERE  `eng_type` = #{eng_type} AND  `confirm_date` LIKE  concat(#{confirm_date},'%')
    </select>

    <select id="selectTotalCost"  resultType="java.math.BigDecimal" >
        SELECT SUM(`total_cost`) FROM `mqms_voucher`
        WHERE  `eng_type` = #{eng_type} AND  `confirm_date` LIKE  concat(#{confirm_date},'%')
    </select>

    <select id="selectByVoucherCode"  resultType="java.lang.Integer" >
        SELECT COUNT(*) FROM `mqms_voucher`
        WHERE  `voucher_code` = #{voucher_code}
    </select>
    <update id="updateMqmsVoucher">
        UPDATE `mqms_voucher`
        SET
        <trim suffixOverrides=",">
            <if test="voucherCode != null and voucherCode!=''">
                `voucher_code` = #{voucherCode},
            </if>
            <if test="claimCode != null and claimCode!=''">
                `claim_code` = #{claimCode},
            </if>
            <if test="dealerCode != null and dealerCode!=''">
                `dealer_code` = #{dealerCode},
            </if>
            <if test="dealerName != null and dealerName!=''">
                `dealer_name` = #{dealerName},
            </if>
            <if test="dealerShortName != null and dealerShortName!=''">
                `dealer_short_name` = #{dealerShortName},
            </if>
            <if test="theme != null and theme!=''">
                `theme` = #{theme},
            </if>
            <if test="vinCode != null and vinCode!=''">
                `vin_code` = #{vinCode},
            </if>
            <if test="vehicleType != null and vehicleType!=''">
                `vehicle_type` = #{vehicleType},
            </if>
            <if test="productionCode != null and productionCode!=''">
                `production_code` = #{productionCode},
            </if>
            <if test="partsCode != null and partsCode!=''">
                `parts_code` = #{partsCode},
            </if>
            <if test="partsName != null and partsName!=''">
                `parts_name` = #{partsName},
            </if>
            <if test="divisionLevel1 != null and divisionLevel1!=''">
                `division_level_1` = #{divisionLevel1},
            </if>
            <if test="divisionLevel2 != null and divisionLevel2!=''">
                `division_level_2` = #{divisionLevel2},
            </if>
            <if test="divisionLevel3 != null and divisionLevel3!=''">
                `division_level_3` = #{divisionLevel3},
            </if>
            <if test="partsAndSymptom != null and partsAndSymptom!=''">
                `parts_and_symptom` = #{partsAndSymptom},
            </if>
            <if test="offlineDate != null and offlineDate!=''">
                `offline_date` = #{offlineDate},
            </if>
            <if test="salesDate != null and salesDate!=''">
                `sales_date` = #{salesDate},
            </if>
            <if test="failureDate != null and failureDate!=''">
                `failure_date` = #{failureDate},
            </if>
            <if test="mileage != null">
                `mileage` = #{mileage},
            </if>
            <if test="confirmDate != null and confirmDate!=''">
                `confirm_date` = #{confirmDate},
            </if>
            <if test="warehousingDate != null and warehousingDate!=''">
                `warehousing_date` = #{warehousingDate},
            </if>
            <if test="transportDate != null and transportDate!=''">
                `transport_date` = #{transportDate},
            </if>
            <if test="shopArrivalDate != null and shopArrivalDate!=''">
                `shop_arrival_date` = #{shopArrivalDate},
            </if>
            <if test="salesFailureTime != null">
                `sales_failure_time` = #{salesFailureTime},
            </if>
            <if test="failureDesc != null and failureDesc!=''">
                `failure_desc` = #{failureDesc},
            </if>
            <if test="diagnosticResult != null and diagnosticResult!=''">
                `diagnostic_result` = #{diagnosticResult},
            </if>
            <if test="manCost != null">
                `man_cost` = #{manCost},
            </if>
            <if test="materialCost != null">
                `material_cost` = #{materialCost},
            </if>
            <if test="materialManagementCost != null">
                `material_management_cost` = #{materialManagementCost},
            </if>
            <if test="goOutCost != null">
                `go_out_cost` = #{goOutCost},
            </if>
            <if test="maintainingCost != null">
                `maintaining_cost` = #{maintainingCost},
            </if>
            <if test="otherCost != null">
                `other_cost` = #{otherCost},
            </if>
            <if test="totalCost != null">
                `total_cost` = #{totalCost},
            </if>
            <if test="importantLevel != null and importantLevel!=''">
                `important_level` = #{importantLevel},
            </if>
            <if test="transmissionType != null and transmissionType!=''">
                `transmission_type` = #{transmissionType},
            </if>
            <if test="newPartsBond != null and newPartsBond!=''">
                `new_parts_bond` = #{newPartsBond},
            </if>
            <if test="submitDate != null and submitDate!=''">
                `submit_date` = #{submitDate},
            </if>
            <if test="egtypeCode != null and egtypeCode!=''">
                `egtype_code` = #{egtypeCode},
            </if>
            <if test="engProductionDate != null and engProductionDate!=''">
                `eng_production_date` = #{engProductionDate},
            </if>
            <if test="transmissionCode != null and transmissionCode!=''">
                `transmission_code` = #{transmissionCode},
            </if>
            <if test="transmissionProductionDate != null and transmissionProductionDate!=''">
                `transmission_production_date` = #{transmissionProductionDate},
            </if>
            <if test="engArrange != null and engArrange!=''">
                `eng_arrange` = #{engArrange},
            </if>
            <if test="carModel != null and carModel!=''">
                `car_model` = #{carModel},
            </if>
            <if test="engType != null and engType!=''">
                `eng_type` = #{engType},
            </if>
            <if test="receiveTime != null and receiveTime!=''">
                `receive_time` = #{receiveTime},
            </if>
            <if test="claimCompensation != null and claimCompensation!=''">
                `claim_compensation` = #{claimCompensation},
            </if>
            <if test="productionRawDescription != null and productionRawDescription!=''">
                `production_raw_description` = #{productionRawDescription},
            </if>
            <if test="PDI != null and PDI!=''">
                `PDI` = #{PDI},
            </if>
            <if test="offlineFailureTime != null">
                `offline_failure_time` = #{offlineFailureTime},
            </if>
            <if test="engOrTran != null and engOrTran!=''">
                `eng_or_tran` = #{engOrTran},
            </if>
            <if test="carSeriesCode != null and carSeriesCode!=''">
                `car_series_code` = #{carSeriesCode},
            </if>
            <if test="shortCode != null and shortCode!=''">
                `short_code` = #{shortCode},
            </if>
            <if test="faultCodeClassification != null and faultCodeClassification!=''">
                `fault_code_classification` = #{faultCodeClassification},
            </if>
            <if test="failureYear != null and failureYear!=''">
                `failure_year` = #{failureYear},
            </if>
            <if test="failureMonth != null and failureMonth!=''">
                `failure_month` = #{failureMonth},
            </if>
            <if test="transmissionShortCode != null and transmissionShortCode!=''">
                `transmission_short_code` = #{transmissionShortCode},
            </if>
            <if test="mileageDistribution != null and mileageDistribution!=''">
                `mileage_distribution` = #{mileageDistribution},
            </if>
            <if test="returnRequest != null and returnRequest!=''">
                `return_request` = #{returnRequest},
            </if>
            <if test="returnDate != null and returnDate!=''">
                `return_date` = #{returnDate},
            </if>
            <if test="arriveDate != null and arriveDate!=''">
                `arrive_date` = #{arriveDate},
            </if>
            <if test="loadingVerification != null and loadingVerification!=''">
                `loading_verification` = #{loadingVerification},
            </if>
            <if test="faultReconstructioner != null and faultReconstructioner!=''">
                `fault_reconstructioner` = #{faultReconstructioner},
            </if>
            <if test="loadingDate != null and loadingDate!=''">
                `loading_date` = #{loadingDate},
            </if>
            <if test="faultReconstruction != null and faultReconstruction!=''">
                `fault_reconstruction` = #{faultReconstruction},
            </if>
            <if test="faultReconstructionDate != null and faultReconstructionDate!=''">
                `fault_reconstruction_date` = #{faultReconstructionDate},
            </if>
            <if test="transferDate1 != null and transferDate1!=''">
                `transfer_date1` = #{transferDate1},
            </if>
            <if test="responsible1 != null and responsible1!=''">
                `responsible1` = #{responsible1},
            </if>
            <if test="transferDate2 != null and transferDate2!=''">
                `transfer_date2` = #{transferDate2},
            </if>
            <if test="responsible2 != null and responsible2!=''">
                `responsible2` = #{responsible2},
            </if>
            <if test="estimateMeetingDate != null and estimateMeetingDate!=''">
                `estimate_meeting_date` = #{estimateMeetingDate},
            </if>
            <if test="submitReport != null and submitReport!=''">
                `submit_report` = #{submitReport},
            </if>
            <if test="reason != null and reason!=''">
                `reason` = #{reason},
            </if>
            <if test="countermeasure != null and countermeasure!=''">
                `countermeasure` = #{countermeasure},
            </if>
            <if test="reportSubmit != null and reportSubmit!=''">
                `report_submit` = #{reportSubmit},
            </if>
            <if test="claimIndemnity != null and claimIndemnity!=''">
                `claim_indemnity` = #{claimIndemnity},
            </if>
            <if test="questionType != null and questionType!=''">
                `question_type` = #{questionType},
            </if>
            <if test="questionState != null and questionState!=''">
                `question_state` = #{questionState},
            </if>
            <if test="responsibleDepartment != null and responsibleDepartment!=''">
                `responsible_department` = #{responsibleDepartment},
            </if>
            <if test="applierId != null">
                `applier_id` = #{applierId},
            </if>
            <if test="applierName != null and applierName!=''">
                `applier_name` = #{applierName},
            </if>
            <if test="applyTime != null and applyTime!=''">
                `apply_time` = #{applyTime},
            </if>
        </trim>
        WHERE
        <trim suffixOverrides="and">
            `voucher_code` = #{voucherCode} and
        </trim>
    </update>

    <resultMap id="TransmissionProportionMap" type="TransmissionProportion">
        <result property="transmissionCodeRe" column="transmission_code_re"/>
        <result property="number" column="number"/>
    </resultMap>
    <resultMap id="FailureTop10Map" type="FailureTop10">
        <result property="engArrange" column="eng_arrange"/>
        <result property="number" column="number"/>
    </resultMap>
    <select id="calTransmissionProportion" resultMap="TransmissionProportionMap" parameterType="MqmsVoucher">
        SELECT
            transmission_code_re,
            count(*) as number
        FROM
            `mqms_voucher`
        <trim prefix="where" suffixOverrides="and | or">
            <if test="engType != null">
            `eng_type` = #{engType} and
            </if>
        </trim>
        GROUP BY
            transmission_code_re;
    </select>

    <select id="failureTop10" resultMap="FailureTop10Map" parameterType="MqmsVoucher">
        SELECT
        eng_arrange,
        count(*) as number
        FROM
        `mqms_voucher`
        <trim prefix="where" suffixOverrides="and | or">
            <if test="engType != null">
                `eng_type` = #{engType} and
            </if>
        </trim>
        GROUP BY
        eng_arrange
        ORDER BY
        number desc
        LIMIT 0,10;
    </select>

    <select id="countBetweenYearAndMonth" resultType="java.lang.Integer">
        SELECT count(*) FROM `mqms_voucher`
        WHERE
        eng_type = #{eng_type} and `sales_date` &gt;= #{begin} and `sales_date` &lt; #{end}
    </select>
    <select id="salesFailureTimeBetween" resultType="java.lang.Integer">
        SELECT count(*) FROM `mqms_voucher`
        WHERE
        eng_type = #{eng_type} and `sales_failure_time` &gt;= #{begin} and `sales_failure_time` &lt;= #{end}
    </select>

</mapper>